<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Legal Compliance Check (Cookies & Privacy)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <style>
    :root {
      --droptica-primary: #0039FF;
      --droptica-success: #10B981;
      --droptica-warning: #F59E0B;
      --droptica-danger: #DC2626;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f9fa;
      padding: 20px;
    }

    h2 {
      color: var(--droptica-primary);
      border-bottom: 2px solid var(--droptica-primary);
      padding-bottom: 10px;
    }

    h3 {
      color: var(--droptica-primary);
      margin-top: 1.5rem;
    }

    .card {
      border: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .section-intro {
      background: rgba(0, 57, 255, 0.05);
      padding: 15px;
      border-left: 4px solid var(--droptica-primary);
      margin: 20px 0;
      border-radius: 4px;
    }

    .error-message {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid var(--droptica-warning);
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
    }

    .error-message h3 {
      color: var(--droptica-warning);
      margin-top: 0;
    }

    .error-message code {
      background: #fff;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }

    .score-card {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .score-item {
      background: var(--droptica-primary);
      color: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .score-item.pass {
      background: var(--droptica-success);
    }

    .score-item.warning {
      background: var(--droptica-warning);
    }

    .score-item.fail {
      background: var(--droptica-danger);
    }

    .score-item.critical {
      background: var(--droptica-danger);
    }

    .score-value {
      font-size: 2.5em;
      font-weight: bold;
      margin: 10px 0;
    }

    .score-label {
      font-size: 0.9em;
      opacity: 0.9;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    thead {
      background: var(--droptica-primary);
      color: white;
    }

    th {
      padding: 12px;
      text-align: left;
      font-weight: 600;
    }

    td {
      padding: 12px;
      border-bottom: 1px solid #ecf0f1;
    }

    tr:hover {
      background: #f8f9fa;
    }

    .issue-card {
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      padding: 15px;
      margin: 15px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .issue-card.error {
      border-left: 4px solid var(--droptica-danger);
    }

    .issue-card.warning {
      border-left: 4px solid var(--droptica-warning);
    }

    .issue-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .issue-code {
      background: #ecf0f1;
      padding: 4px 8px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    .issue-type {
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 0.85em;
      font-weight: bold;
      text-transform: uppercase;
    }

    .issue-type.error {
      background: var(--droptica-danger);
      color: white;
    }

    .issue-type.warning {
      background: var(--droptica-warning);
      color: white;
    }

    .issue-message {
      color: #555;
      margin: 10px 0;
    }

    .issue-context {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.85em;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .issue-selector {
      color: #7f8c8d;
      font-size: 0.9em;
      margin-top: 8px;
      font-family: 'Courier New', monospace;
    }

    .principle-card {
      background: #f8f9fa;
      border-radius: 6px;
      padding: 15px;
      margin: 10px 0;
    }

    .principle-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .principle-name {
      font-weight: bold;
      color: #2c3e50;
    }

    .principle-count {
      background: var(--droptica-primary);
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.9em;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.85em;
      font-weight: bold;
      margin: 0 5px;
    }

    .badge.success {
      background: var(--droptica-success);
      color: white;
    }

    .badge.warning {
      background: var(--droptica-warning);
      color: white;
    }

    .badge.danger {
      background: var(--droptica-danger);
      color: white;
    }

    .info-box {
      background: rgba(0, 57, 255, 0.05);
      border-left: 4px solid var(--droptica-primary);
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }

    .info-box strong {
      color: var(--droptica-primary);
    }

    code {
      background: #ecf0f1;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    .no-issues {
      text-align: center;
      padding: 40px;
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 6px;
      color: #10B981;
      font-size: 1.1em;
    }

    @media (max-width: 768px) {
      .score-card {
        grid-template-columns: 1fr;
      }

      table {
        font-size: 0.9em;
      }

      .issue-header {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <section class="card shadow-sm mb-4">
      <div class="card-body p-4">
    <div class="container">
        <h2 class="mb-4"><i class="bi bi-shield-check"></i> Legal Compliance Check (Cookies & Privacy)</h2>

        <div id="url-info" class="info-box">
            <strong>Tested URL:</strong> <span id="tested-url">Loading...</span>
        </div>

        <div class="section-intro">
            <p><strong>About this section:</strong> This report analyzes website legal compliance regarding cookie banners, privacy policy, and GDPR/RODO mentions. The checks support both Polish and English websites.</p>
        </div>

                <div id="loading" class="text-center text-muted my-5">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading legal compliance data...</span>
            </div>
            <p class="mt-2">Loading legal compliance data...</p>
        </div>

        <div id="content"></div>
    </div>

    <script>
        const jsonData = __LEGAL_COMPLIANCE_JSON_PLACEHOLDER__;

        function renderLegalCompliance() {
            const container = document.getElementById('content');

            // Handle data structure - can be nested or direct
            const data = jsonData.analysis || jsonData;

            // Check for errors
            if (data.error) {
                container.innerHTML = `
                    <div class="error-message">
                        <h3> Analysis Not Available</h3>
                        <p><strong>Error:</strong> ${data.error}</p>
                        <p>Make sure BASE_URL is set correctly and curl is installed.</p>
                    </div>
                `;
                return;
            }

            // Update URL info
            const testedUrl = data.url || 'Unknown';
            const urlElement = document.getElementById('tested-url');
            if (urlElement) {
                urlElement.innerHTML = `<a href="${testedUrl}" target="_blank" class="url-link">${testedUrl}</a>`;
            }

            const { cookie_banner, privacy_policy, gdpr_compliance, summary } = data;

            // Summary Score
            let html = '<h2 class="mb-4"><i class="bi bi-shield-check"></i> Legal Compliance Check (Cookies & Privacy)</h2>';
            html += '<div class="score-card">';

            html += `
                <div class="score-item ${summary.compliance_status}">
                    <div class="score-label">Compliance Score</div>
                    <div class="score-value">${summary.compliance_score}/100</div>
                </div>
                <div class="score-item">
                    <div class="score-label">Checks Performed</div>
                    <div class="score-value">${summary.checks_performed}</div>
                </div>
                <div class="score-item">
                    <div class="score-label">Checks Passed</div>
                    <div class="score-value">${summary.checks_passed}/${summary.checks_performed}</div>
                </div>
            `;
            html += '</div>';

            // Compliance Status Message
            html += '<div class="info-box">';
            html += `<strong>Status:</strong> `;
            if (summary.compliance_status === 'good') {
                html += `<span class="badge success">Good Compliance</span> - Website shows proper cookie consent and privacy policy implementation.`;
            } else if (summary.compliance_status === 'fair') {
                html += `<span class="badge warning">Fair Compliance</span> - Some compliance elements detected but improvements needed.`;
            } else if (summary.compliance_status === 'poor') {
                html += `<span class="badge danger">Poor Compliance</span> - Critical compliance elements missing.`;
            } else {
                html += `<span class="badge danger">Critical Issues</span> - Major legal compliance requirements not met.`;
            }
            html += '<br>';
            html += `<strong>Test Date:</strong> ${data.timestamp}`;
            html += '</div>';

            // Cookie Banner Check
            html += '<h2>üç™ Cookie Banner Check</h2>';
            html += `<div class="check-card ${cookie_banner.detected ? 'pass' : 'fail'}">`;
            html += '<div class="check-header">';
            html += '<div class="check-title">Cookie Consent Banner</div>';
            html += `<div class="check-status ${cookie_banner.detected ? 'pass' : 'fail'}">${cookie_banner.detected ? 'DETECTED' : 'NOT FOUND'}</div>`;
            html += '</div>';

            if (cookie_banner.detected) {
                html += `<p>Cookie consent mechanism detected with <span class="confidence-badge ${cookie_banner.confidence}">${cookie_banner.confidence.toUpperCase()}</span> confidence.</p>`;

                if (cookie_banner.libraries_detected && cookie_banner.libraries_detected.length > 0) {
                    html += '<div class="detail-section">';
                    html += '<div class="detail-label"> Detected Cookie Libraries:</div>';
                    html += '<ul class="detail-list">';
                    cookie_banner.libraries_detected.forEach(lib => {
                        html += `<li><strong>${lib}</strong></li>`;
                    });
                    html += '</ul>';
                    html += '</div>';
                }

                if (cookie_banner.matched_terms && cookie_banner.matched_terms.length > 0) {
                    html += '<div class="detail-section">';
                    html += '<div class="detail-label"> Matched Terms (first 10):</div>';
                    html += '<ul class="detail-list">';
                    cookie_banner.matched_terms.slice(0, 10).forEach(term => {
                        html += `<li>${escapeHtml(term)}</li>`;
                    });
                    html += '</ul>';
                    html += '</div>';
                }
            } else {
                html += '<div class="warning-box">';
                html += '<p><strong> Warning:</strong> No cookie consent banner detected. GDPR/RODO requires explicit user consent before setting non-essential cookies.</p>';
                html += '</div>';
            }
            html += '</div>';

            // Privacy Policy Check
            html += '<h2>üîí Privacy Policy Check</h2>';
            html += `<div class="check-card ${privacy_policy.detected ? 'pass' : 'fail'}">`;
            html += '<div class="check-header">';
            html += '<div class="check-title">Privacy Policy</div>';
            html += `<div class="check-status ${privacy_policy.detected ? 'pass' : 'fail'}">${privacy_policy.detected ? 'FOUND' : 'NOT FOUND'}</div>`;
            html += '</div>';

            if (privacy_policy.detected) {
                html += `<p>Privacy policy link detected with <span class="confidence-badge ${privacy_policy.confidence}">${privacy_policy.confidence.toUpperCase()}</span> confidence.</p>`;

                if (privacy_policy.urls_found && privacy_policy.urls_found.length > 0) {
                    html += '<div class="detail-section">';
                    html += '<div class="detail-label">üîó Detected Privacy Policy URLs:</div>';
                    html += '<ul class="detail-list">';
                    privacy_policy.urls_found.forEach(url => {
                        const fullUrl = url.startsWith('http') ? url : data.url + url;
                        html += `<li><a href="${fullUrl}" target="_blank" class="url-link">${escapeHtml(url)}</a></li>`;
                    });
                    html += '</ul>';
                    html += '</div>';
                }

                if (privacy_policy.matched_terms && privacy_policy.matched_terms.length > 0) {
                    html += '<div class="detail-section">';
                    html += '<div class="detail-label"> Matched Terms (first 10):</div>';
                    html += '<ul class="detail-list">';
                    privacy_policy.matched_terms.slice(0, 10).forEach(term => {
                        html += `<li>${escapeHtml(term)}</li>`;
                    });
                    html += '</ul>';
                    html += '</div>';
                }
            } else {
                html += '<div class="warning-box">';
                html += '<p><strong> Warning:</strong> No privacy policy detected. GDPR/RODO requires clear information about personal data processing.</p>';
                html += '</div>';
            }
            html += '</div>';

            // GDPR/RODO Check
            html += '<h2>üá™üá∫ GDPR/RODO Compliance Mentions</h2>';
            html += `<div class="check-card ${gdpr_compliance.mentioned ? 'pass' : 'fail'}">`;
            html += '<div class="check-header">';
            html += '<div class="check-title">GDPR/RODO References</div>';
            html += `<div class="check-status ${gdpr_compliance.mentioned ? 'pass' : 'fail'}">${gdpr_compliance.mentioned ? 'FOUND' : 'NOT FOUND'}</div>`;
            html += '</div>';

            if (gdpr_compliance.mentioned) {
                html += '<p>GDPR or RODO references detected on the page.</p>';

                if (gdpr_compliance.matched_terms && gdpr_compliance.matched_terms.length > 0) {
                    html += '<div class="detail-section">';
                    html += '<div class="detail-label"> Detected Terms:</div>';
                    html += '<ul class="detail-list">';
                    gdpr_compliance.matched_terms.forEach(term => {
                        html += `<li><strong>${escapeHtml(term)}</strong></li>`;
                    });
                    html += '</ul>';
                    html += '</div>';
                }
            } else {
                html += '<p>No explicit GDPR/RODO mentions detected. While not mandatory, referencing GDPR/RODO can improve transparency.</p>';
            }
            html += '</div>';

            // Recommendations
            html += '<h2>üí° Recommendations</h2>';
            html += '<div class="recommendations">';

            if (summary.compliance_score >= 80) {
                html += '<p><strong>‚úÖ Excellent!</strong> Your website shows good legal compliance practices.</p>';
            } else if (summary.compliance_score >= 60) {
                html += '<p><strong> Fair compliance.</strong> Consider improving missing elements.</p>';
            } else {
                html += '<p><strong>üö® Action required!</strong> Critical compliance elements are missing.</p>';
            }

            html += '<ul>';

            if (!cookie_banner.detected) {
                html += '<li><strong>Install a cookie consent solution</strong> (e.g., Cookiebot, OneTrust, CookieConsent.js) - <strong>Time: 2-3h</strong></li>';
            } else if (cookie_banner.confidence === 'low') {
                html += '<li><strong>Improve cookie banner implementation</strong> - ensure it\'s clearly visible and functional - <strong>Time: 1-2h</strong></li>';
            }

            if (!privacy_policy.detected) {
                html += '<li><strong>Create and link a Privacy Policy page</strong> - document data collection and processing - <strong>Time: 5-8h</strong></li>';
            } else if (privacy_policy.confidence === 'low') {
                html += '<li><strong>Make privacy policy more accessible</strong> - add prominent links in footer and cookie banner - <strong>Time: 1-2h</strong></li>';
            }

            if (!gdpr_compliance.mentioned) {
                html += '<li><strong>Add GDPR/RODO references</strong> in privacy policy and consent forms - <strong>Time: 1-2h</strong></li>';
            }

            html += '<li><strong>Review with legal expert</strong> - ensure full GDPR/RODO compliance - <strong>Time: 8-13h</strong></li>';
            html += '<li><strong>Implement cookie categorization</strong> (essential, analytics, marketing) - <strong>Time: 3-5h</strong></li>';
            html += '<li><strong>Add consent withdrawal mechanism</strong> - allow users to revoke consent - <strong>Time: 2-3h</strong></li>';
            html += '<li><strong>Regular compliance audits</strong> - review compliance after major changes - <strong>Time: 2-3h per audit</strong></li>';
            html += '</ul>';

            html += '<p style="margin-top: 15px;"><strong>Important:</strong> This automated check detects presence of compliance elements but does NOT verify legal correctness. Always consult with legal professionals for GDPR/RODO compliance.</p>';
            html += '</div>';

            // Legal Resources
            html += '<h2>üìö Legal Resources</h2>';
            html += '<div class="info-box">';
            html += '<ul>';
            html += '<li><strong>GDPR Official Text:</strong> <a href="https://gdpr-info.eu/" target="_blank">https://gdpr-info.eu/</a></li>';
            html += '<li><strong>Polish RODO (GDPR):</strong> <a href="https://uodo.gov.pl/" target="_blank">https://uodo.gov.pl/</a></li>';
            html += '<li><strong>Cookie Law Info:</strong> <a href="https://www.cookielaw.org/" target="_blank">https://www.cookielaw.org/</a></li>';
            html += '<li><strong>EU Cookie Directive:</strong> <a href="https://ec.europa.eu/info/cookies_en" target="_blank">https://ec.europa.eu/info/cookies_en</a></li>';
            html += '</ul>';
            html += '</div>';

            container.innerHTML = html;
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Render on page load
        renderLegalCompliance();
    </script>
      </div>
    </section>
  </div>
</body>
