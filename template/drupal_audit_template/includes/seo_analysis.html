<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SEO Analysis</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <style>
    :root {
      --droptica-primary: #0039FF;
      --droptica-success: #10B981;
      --droptica-warning: #F59E0B;
      --droptica-danger: #DC2626;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f9fa;
      padding: 20px;
    }

    h2 {
      color: var(--droptica-primary);
      border-bottom: 2px solid var(--droptica-primary);
      padding-bottom: 10px;
    }

    h3 {
      color: var(--droptica-primary);
      margin-top: 1.5rem;
    }

    .card {
      border: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .section-intro {
      background: rgba(0, 57, 255, 0.05);
      padding: 15px;
      border-left: 4px solid var(--droptica-primary);
      margin: 20px 0;
      border-radius: 4px;
    }

    .error-message {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid var(--droptica-warning);
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
    }

    .error-message h3 {
      color: var(--droptica-warning);
      margin-top: 0;
    }

    .error-message code {
      background: #fff;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }

    .score-card {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .score-item {
      background: var(--droptica-primary);
      color: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .score-item.pass {
      background: var(--droptica-success);
    }

    .score-item.warning {
      background: var(--droptica-warning);
    }

    .score-item.fail {
      background: var(--droptica-danger);
    }

    .score-item.critical {
      background: var(--droptica-danger);
    }

    .score-value {
      font-size: 2.5em;
      font-weight: bold;
      margin: 10px 0;
    }

    .score-label {
      font-size: 0.9em;
      opacity: 0.9;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    thead {
      background: var(--droptica-primary);
      color: white;
    }

    th {
      padding: 12px;
      text-align: left;
      font-weight: 600;
    }

    td {
      padding: 12px;
      border-bottom: 1px solid #ecf0f1;
    }

    tr:hover {
      background: #f8f9fa;
    }

    .issue-card {
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      padding: 15px;
      margin: 15px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .issue-card.error {
      border-left: 4px solid var(--droptica-danger);
    }

    .issue-card.warning {
      border-left: 4px solid var(--droptica-warning);
    }

    .issue-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .issue-code {
      background: #ecf0f1;
      padding: 4px 8px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    .issue-type {
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 0.85em;
      font-weight: bold;
      text-transform: uppercase;
    }

    .issue-type.error {
      background: var(--droptica-danger);
      color: white;
    }

    .issue-type.warning {
      background: var(--droptica-warning);
      color: white;
    }

    .issue-message {
      color: #555;
      margin: 10px 0;
    }

    .issue-context {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.85em;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .issue-selector {
      color: #7f8c8d;
      font-size: 0.9em;
      margin-top: 8px;
      font-family: 'Courier New', monospace;
    }

    .principle-card {
      background: #f8f9fa;
      border-radius: 6px;
      padding: 15px;
      margin: 10px 0;
    }

    .principle-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .principle-name {
      font-weight: bold;
      color: #2c3e50;
    }

    .principle-count {
      background: var(--droptica-primary);
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.9em;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.85em;
      font-weight: bold;
      margin: 0 5px;
      background: #6c757d;
      color: white;
    }

    .badge.success {
      background: var(--droptica-success);
      color: white;
    }

    .badge.warning {
      background: var(--droptica-warning);
      color: white;
    }

    .badge.danger {
      background: var(--droptica-danger);
      color: white;
    }

    .info-box {
      background: rgba(0, 57, 255, 0.05);
      border-left: 4px solid var(--droptica-primary);
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }

    .info-box strong {
      color: var(--droptica-primary);
    }

    code {
      background: #ecf0f1;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    .no-issues {
      text-align: center;
      padding: 40px;
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 6px;
      color: #10B981;
      font-size: 1.1em;
    }

    @media (max-width: 768px) {
      .score-card {
        grid-template-columns: 1fr;
      }

      table {
        font-size: 0.9em;
      }

      .issue-header {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <section class="card shadow-sm mb-4">
      <div class="card-body p-4">
    <div class="container">
        <h2 class="mb-4"><i class="bi bi-search"></i> SEO Analysis</h2>

        <div class="section-intro">
            <strong>About This Section:</strong> This analysis evaluates SEO configuration including metatags, URL patterns, sitemaps, robots.txt, and schema.org markup. Proper SEO setup helps search engines discover and rank your content effectively.
        </div>

        <div id="loading" class="text-center text-muted my-5">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading SEO data...</p>
        </div>

        <div id="content" style="display: none;">
            <!-- SEO Modules Overview -->
            <h2> SEO Modules</h2>
            <div id="seo-modules-section">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 20%;">Module</th>
                            <th style="width: 30%;">Name</th>
                            <th style="width: 40%;">Description</th>
                            <th style="width: 10%;">Status</th>
                        </tr>
                    </thead>
                    <tbody id="seo-modules-body">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Metatags Configuration -->
            <h2>üè∑ Metatags Configuration</h2>
            <div id="metatags-section">
                <!-- Populated by JavaScript -->
            </div>

            <!-- URL Aliases & Pathauto -->
            <h2>üîó URL Aliases & Pathauto</h2>
            <div id="url-aliases-section">
                <!-- Populated by JavaScript -->
            </div>

            <!-- Sitemap -->
            <h2>üó∫ XML Sitemap</h2>
            <div id="sitemap-section">
                <!-- Populated by JavaScript -->
            </div>

            <!-- Robots.txt -->
            <h2>ü§ñ Robots.txt</h2>
            <div id="robotstxt-section">
                <!-- Populated by JavaScript -->
            </div>

            <!-- Schema.org Markup -->
            <h2>üìã Schema.org Structured Data</h2>
            <div id="schema-section">
                <!-- Populated by JavaScript -->
            </div>

            <!-- Redirects -->
            <h2>‚Ü™ Redirects Management</h2>
            <div id="redirects-section">
                <!-- Populated by JavaScript -->
            </div>
        </div>

    </div>

    <script>
        // Safe placeholder handling
        let SEO_DATA;
        try {
            SEO_DATA = __SEO_ANALYSIS_JSON_PLACEHOLDER__;
        } catch (e) {
            SEO_DATA = null;
        }

        function renderSeoModules(modules) {
            const tbody = document.getElementById('seo-modules-body');
            if (!modules || modules.length === 0) {
                document.getElementById('seo-modules-section').innerHTML = '<div class="info-box">No SEO modules data available.</div>';
                return;
            }

            let enabledCount = 0;
            modules.forEach(module => {
                if (module.enabled) enabledCount++;

                const row = document.createElement('tr');
                // Use the boolean 'enabled' field primarily
                let statusClass, statusText;
                if (module.enabled === true) {
                    statusClass = 'badge success';
                    statusText = '‚úì Enabled';
                } else if (module.status === 'disabled') {
                    statusClass = 'badge warning';
                    statusText = 'Disabled';
                } else {
                    statusClass = 'badge';
                    statusText = 'Not Installed';
                }

                row.innerHTML = `
                    <td><code>${module.module}</code></td>
                    <td><strong>${module.name}</strong></td>
                    <td>${module.description}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                `;
                tbody.appendChild(row);
            });

            // Add summary
            const summary = document.createElement('div');
            summary.className = enabledCount >= 3 ? 'success-box' : 'warning-box';
            summary.innerHTML = `<strong>Summary:</strong> ${enabledCount} of ${modules.length} SEO modules are enabled.`;
            document.getElementById('seo-modules-section').insertBefore(summary, document.getElementById('seo-modules-section').firstChild);
        }

        function renderMetatags(metatags) {
            const section = document.getElementById('metatags-section');
            if (!metatags || metatags.status !== 'enabled') {
                section.innerHTML = '<div class="warning-box"><strong>Warning:</strong> Metatag module is not enabled. Enable it to manage page metadata for SEO.</div>';
                return;
            }

            let html = '';

            if (metatags.global_defaults_configured) {
                html += '<div class="success-box"><strong>‚úì Global defaults configured</strong></div>';
            }

            html += `<p><strong>Entity type configurations:</strong> ${metatags.entity_type_configs || 0}</p>`;

            if (metatags.entity_types && metatags.entity_types.length > 0) {
                html += '<p><strong>Configured entity types:</strong></p><ul>';
                metatags.entity_types.forEach(type => {
                    html += `<li><code>${type}</code></li>`;
                });
                html += '</ul>';
            }

            // Submodules
            html += '<h3>Metatag Submodules</h3>';
            html += '<table><thead><tr><th>Submodule</th><th>Status</th></tr></thead><tbody>';

            const submodules = [
                { name: 'Open Graph', status: metatags.submodules?.open_graph },
                { name: 'Twitter Cards', status: metatags.submodules?.twitter_cards },
                { name: 'Mobile', status: metatags.submodules?.mobile },
                { name: 'Schema Metatag', status: metatags.submodules?.schema_metatag }
            ];

            submodules.forEach(sub => {
                const statusLower = (sub.status || '').toLowerCase();
                const statusClass = statusLower === 'enabled' ? 'badge success' : 'badge';
                const statusText = statusLower === 'enabled' ? '‚úì Enabled' : 'Not Enabled';
                html += `<tr>
                    <td>${sub.name}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                </tr>`;
            });

            html += '</tbody></table>';
            section.innerHTML = html;
        }

        function renderUrlAliases(aliases) {
            const section = document.getElementById('url-aliases-section');
            if (!aliases) {
                section.innerHTML = '<div class="info-box">No URL aliases data available.</div>';
                return;
            }

            let html = '';

            if (aliases.pathauto_enabled) {
                html += '<div class="success-box"><strong>‚úì Pathauto module is enabled</strong> - Automatic URL alias generation is configured.</div>';
                html += `<p><strong>Total URL aliases:</strong> ${aliases.total_aliases || 0}</p>`;
                html += `<p><strong>Pathauto patterns:</strong> ${aliases.patterns_count || 0}</p>`;

                if (aliases.patterns && aliases.patterns.length > 0) {
                    html += '<h3>Configured Patterns</h3>';
                    aliases.patterns.forEach(pattern => {
                        if (pattern && pattern.pattern) {
                            html += `<div class="pattern-item">
                                <strong>${pattern.label || pattern.id}</strong><br>
                                <span class="alias-preview">${pattern.pattern || 'N/A'}</span>
                            </div>`;
                        }
                    });
                }
            } else {
                html += '<div class="warning-box"><strong>Warning:</strong> Pathauto module is not enabled. URL aliases must be created manually.</div>';
                html += `<p><strong>Total manual aliases:</strong> ${aliases.total_aliases || 0}</p>`;
            }

            // Sample aliases
            if (aliases.sample_aliases && aliases.sample_aliases.length > 0) {
                html += '<h3>Sample Aliases (first 10)</h3>';
                html += '<table><thead><tr><th>Internal Path</th><th>URL Alias</th></tr></thead><tbody>';
                aliases.sample_aliases.forEach(alias => {
                    if (alias.path && alias.alias) {
                        html += `<tr>
                            <td><code>${alias.path}</code></td>
                            <td><code>${alias.alias}</code></td>
                        </tr>`;
                    }
                });
                html += '</tbody></table>';
            }

            section.innerHTML = html;
        }

        function renderSitemap(sitemap) {
            const section = document.getElementById('sitemap-section');
            if (!sitemap) {
                section.innerHTML = '<div class="info-box">No sitemap data available.</div>';
                return;
            }

            let html = '';

            if (sitemap.type === 'none') {
                html = '<div class="warning-box"><strong>Warning:</strong> No sitemap module detected. Install simple_sitemap module for automatic XML sitemap generation.</div>';
            } else if (sitemap.type === 'simple_sitemap') {
                html = '<div class="success-box"><strong>‚úì Simple Sitemap module is enabled</strong></div>';
                html += `<p><strong>Sitemap variants:</strong> ${sitemap.variants_count || 0}</p>`;

                if (sitemap.variants && sitemap.variants.length > 0) {
                    html += '<p><strong>Configured variants:</strong></p><ul>';
                    sitemap.variants.forEach(variant => {
                        html += `<li><code>${variant}</code></li>`;
                    });
                    html += '</ul>';
                }
            } else if (sitemap.type === 'xmlsitemap') {
                html = '<div class="success-box"><strong>‚úì XML Sitemap module is enabled</strong></div>';
            }

            section.innerHTML = html;
        }

        function renderRobotstxt(robotstxt) {
            const section = document.getElementById('robotstxt-section');
            if (!robotstxt) {
                section.innerHTML = '<div class="info-box">No robots.txt data available.</div>';
                return;
            }

            let html = '';

            if (!robotstxt.file_exists) {
                html = '<div class="warning-box"><strong>Warning:</strong> robots.txt file not found in webroot.</div>';
            } else {
                html = '<div class="success-box"><strong>‚úì robots.txt file exists</strong></div>';
                html += `<p><strong>File size:</strong> ${robotstxt.file_size} bytes</p>`;
                html += '<ul>';
                html += `<li>Sitemap reference: ${robotstxt.has_sitemap_reference ? '‚úì Yes' : '‚úó No'}</li>`;
                html += `<li>Disallow rules: ${robotstxt.has_disallow_rules ? '‚úì Yes' : '‚úó No'}</li>`;
                html += `<li>Allow rules: ${robotstxt.has_allow_rules ? '‚úì Yes' : '‚úó No'}</li>`;
                html += `<li>User agents: ${robotstxt.user_agents_count}</li>`;
                html += '</ul>';

                if (robotstxt.content) {
                    html += '<h3>File Contents</h3>';
                    html += `<pre><code>${robotstxt.content}</code></pre>`;
                }
            }

            if (robotstxt.module_status === 'enabled') {
                html += '<div class="info-box"><strong>Note:</strong> RobotsTxt module is enabled for dynamic robots.txt management.</div>';
            }

            section.innerHTML = html;
        }

        function renderSchemaMarkup(schema) {
            const section = document.getElementById('schema-section');
            if (!schema) {
                section.innerHTML = '<div class="info-box">No schema markup data available.</div>';
                return;
            }

            let html = '';

            if (schema.has_schema_support) {
                html = '<div class="success-box"><strong>‚úì Schema.org support is available</strong></div>';
                html += `<p><strong>Enabled schema modules:</strong> ${schema.enabled_count}</p>`;
            } else {
                html = '<div class="warning-box"><strong>Warning:</strong> No schema.org modules enabled. Consider installing schema_metatag for structured data.</div>';
            }

            html += '<h3>Schema Modules</h3>';
            html += '<table><thead><tr><th>Module</th><th>Status</th></tr></thead><tbody>';

            const modules = [
                { name: 'Schema Metatag', key: 'schema_metatag' },
                { name: 'JSON-LD', key: 'jsonld' },
                { name: 'Schema Article', key: 'schema_article' },
                { name: 'Schema Organization', key: 'schema_organization' },
                { name: 'Schema Web Page', key: 'schema_web_page' }
            ];

            modules.forEach(mod => {
                const status = schema.modules?.[mod.key];
                const statusLower = (status || '').toLowerCase();
                const statusClass = statusLower === 'enabled' ? 'badge success' : 'badge';
                const statusText = statusLower === 'enabled' ? '‚úì Enabled' : 'Not Installed';
                html += `<tr>
                    <td>${mod.name}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                </tr>`;
            });

            html += '</tbody></table>';
            section.innerHTML = html;
        }

        function renderRedirects(redirects) {
            const section = document.getElementById('redirects-section');
            if (!redirects) {
                section.innerHTML = '<div class="info-box">No redirects data available.</div>';
                return;
            }

            let html = '';

            if (redirects.redirect_module === 'enabled') {
                html = '<div class="success-box"><strong>‚úì Redirect module is enabled</strong></div>';
                html += `<p><strong>Total redirects:</strong> ${redirects.total_redirects || 0}</p>`;
            } else {
                html = '<div class="warning-box"><strong>Warning:</strong> Redirect module is not enabled. URL redirects must be managed manually.</div>';
            }

            if (redirects.global_redirect_module === 'enabled') {
                html += '<div class="info-box"><strong>‚úì Global Redirect module is enabled</strong> - Ensures canonical URLs.</div>';
            }

            section.innerHTML = html;
        }

        // Initialize
        function renderSEOAnalysis() {
            if (!SEO_DATA) {
                // Keep loading spinner visible
                return;
            }

            // Hide spinner and show content
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';

            // Extract nested data
            const data = SEO_DATA.seo_analysis?.full_analysis || SEO_DATA.seo_analysis || SEO_DATA;

            // Render all sections
            renderSeoModules(data.seo_modules);
            renderMetatags(data.metatags);
            renderUrlAliases(data.url_aliases);
            renderSitemap(data.sitemap);
            renderRobotstxt(data.robotstxt);
            renderSchemaMarkup(data.schema_markup);
            renderRedirects(data.redirects);
        }

        // Call render function
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', renderSEOAnalysis);
        } else {
            renderSEOAnalysis();
        }

    </script>
      </div>
    </section>
  </div>
</body>
