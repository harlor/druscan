<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Accessibility Analysis (WCAG 2.1)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <style>
    :root {
      --droptica-primary: #0039FF;
      --droptica-success: #10B981;
      --droptica-warning: #F59E0B;
      --droptica-danger: #DC2626;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f9fa;
      padding: 20px;
    }

    h2 {
      color: var(--droptica-primary);
      border-bottom: 2px solid var(--droptica-primary);
      padding-bottom: 10px;
    }

    h3 {
      color: var(--droptica-primary);
      margin-top: 1.5rem;
    }

    .card {
      border: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .section-intro {
      background: rgba(0, 57, 255, 0.05);
      padding: 15px;
      border-left: 4px solid var(--droptica-primary);
      margin: 20px 0;
      border-radius: 4px;
    }

    .error-message {
      background: #fff3cd;
      border: 1px solid var(--droptica-warning);
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
    }

    .error-message h3 {
      color: #856404;
      margin-top: 0;
    }

    .error-message code {
      background: #fff;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }

    .score-card {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .score-item {
      background: var(--droptica-primary);
      color: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .score-item.pass {
      background: var(--droptica-success);
    }

    .score-item.warning {
      background: var(--droptica-warning);
    }

    .score-item.fail {
      background: var(--droptica-danger);
    }

    .score-item.critical {
      background: var(--droptica-danger);
    }

    .score-value {
      font-size: 2.5em;
      font-weight: bold;
      margin: 10px 0;
    }

    .score-label {
      font-size: 0.9em;
      opacity: 0.9;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    thead {
      background: var(--droptica-primary);
      color: white;
    }

    th {
      padding: 12px;
      text-align: left;
      font-weight: 600;
    }

    td {
      padding: 12px;
      border-bottom: 1px solid #ecf0f1;
    }

    tr:hover {
      background: #f8f9fa;
    }

    .issue-card {
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      padding: 15px;
      margin: 15px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .issue-card.error {
      border-left: 4px solid var(--droptica-danger);
    }

    .issue-card.warning {
      border-left: 4px solid var(--droptica-warning);
    }

    .issue-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .issue-code {
      background: #ecf0f1;
      padding: 4px 8px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    .issue-type {
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 0.85em;
      font-weight: bold;
      text-transform: uppercase;
    }

    .issue-type.error {
      background: var(--droptica-danger);
      color: white;
    }

    .issue-type.warning {
      background: var(--droptica-warning);
      color: white;
    }

    .issue-message {
      color: #555;
      margin: 10px 0;
    }

    .issue-context {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.85em;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .issue-selector {
      color: #7f8c8d;
      font-size: 0.9em;
      margin-top: 8px;
      font-family: 'Courier New', monospace;
    }

    .principle-card {
      background: #f8f9fa;
      border-radius: 6px;
      padding: 15px;
      margin: 10px 0;
    }

    .principle-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .principle-name {
      font-weight: bold;
      color: #2c3e50;
    }

    .principle-count {
      background: var(--droptica-primary);
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.9em;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.85em;
      font-weight: bold;
      margin: 0 5px;
    }

    .badge.success {
      background: var(--droptica-success);
      color: white;
    }

    .badge.warning {
      background: var(--droptica-warning);
      color: white;
    }

    .badge.danger {
      background: var(--droptica-danger);
      color: white;
    }

    .info-box {
      background: rgba(0, 57, 255, 0.05);
      border-left: 4px solid var(--droptica-primary);
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }

    .info-box strong {
      color: var(--droptica-primary);
    }

    code {
      background: #ecf0f1;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    .no-issues {
      text-align: center;
      padding: 40px;
      background: #d4edda;
      border: 1px solid #c3e6cb;
      border-radius: 6px;
      color: #155724;
      font-size: 1.1em;
    }

    @media (max-width: 768px) {
      .score-card {
        grid-template-columns: 1fr;
      }

      table {
        font-size: 0.9em;
      }

      .issue-header {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="mb-4"><i class="bi bi-universal-access"></i> Accessibility Analysis (WCAG 2.1)</h2>

    <div id="accessibility-url-info" class="alert alert-info border-start border-4 border-info mb-4">
      <i class="bi bi-globe me-2"></i>
      <strong>Tested URL:</strong> <span id="tested-url">Loading...</span>
    </div>

    <div class="section-intro">
      <p><strong>About this section:</strong> This report analyzes website accessibility compliance with WCAG 2.1 Level AA standards using Pa11y automated testing tool. It identifies issues that may prevent people with disabilities from accessing your content.</p>
    </div>

            <div id="loading" class="text-center text-muted my-5">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading accessibility data...</span>
            </div>
            <p class="mt-2">Loading accessibility data...</p>
        </div>

        <div id="content"></div>
  </div>

  <script>
    const jsonData = __ACCESSIBILITY_JSON_PLACEHOLDER__;

    function renderAccessibility() {
      const container = document.getElementById('content');
      const loadingElement = document.getElementById('loading');

      // Check for errors (handle both direct error and nested in analysis)
      const data = jsonData.analysis || jsonData;

      // Update URL info
      const testedUrl = data.url || data.homepage?.url || 'Unknown';
      const urlElement = document.getElementById('tested-url');
      if (urlElement) {
        urlElement.textContent = testedUrl;
      }

      if (data.error) {
        container.innerHTML = `
          <div class="error-message">
            <h3>‚ö†Ô∏è Pa11y Not Available</h3>
            <p><strong>Error:</strong> ${data.error}</p>
            <p>To enable accessibility testing, install Pa11y globally:</p>
            <code>npm install -g pa11y</code>
            <p style="margin-top: 10px;">Pa11y is an automated accessibility testing tool that helps identify WCAG 2.1 compliance issues.</p>
          </div>
        `;
        loadingElement.style.display = 'none';
        return;
      }

      const { homepage, summary } = data;

      if (!homepage || !summary) {
        container.innerHTML = `
          <div class="error-message">
            <h3>No Data Available</h3>
            <p>Accessibility analysis could not be performed. Make sure BASE_URL is set correctly.</p>
          </div>
        `;
        loadingElement.style.display = 'none';
        return;
      }

      // Summary Score Cards
      let html = '<h2>üìä Accessibility Summary</h2>';
      html += '<div class="score-card">';

      html += `
        <div class="score-item ${summary.compliance_status}">
          <div class="score-label">Accessibility Score</div>
          <div class="score-value">${summary.accessibility_score}/100</div>
        </div>
        <div class="score-item">
          <div class="score-label">Total Issues</div>
          <div class="score-value">${homepage.total_issues || 0}</div>
        </div>
        <div class="score-item">
          <div class="score-label">Errors</div>
          <div class="score-value">${homepage.errors_count || 0}</div>
        </div>
        <div class="score-item">
          <div class="score-label">Warnings</div>
          <div class="score-value">${homepage.warnings_count || 0}</div>
        </div>
      `;
      html += '</div>';

      // Compliance Status
      html += '<div class="info-box">';
      html += `<strong>Compliance Status:</strong> ${summary.compliance_level}<br>`;
      html += `<strong>Standard:</strong> ${summary.test_standard}<br>`;
      html += `<strong>Tested URL:</strong> <code>${summary.tested_url}</code><br>`;
      html += `<strong>Test Date:</strong> ${summary.test_date}`;
      html += '</div>';

      // WCAG Principles Breakdown
      if (homepage.wcag_principles) {
        html += '<h2>üéØ WCAG Principles Breakdown</h2>';
        html += '<p>Issues categorized by the four main WCAG 2.1 principles:</p>';

        const principles = [
          { key: 'perceivable', name: '1. Perceivable', desc: 'Information and UI must be presentable to users' },
          { key: 'operable', name: '2. Operable', desc: 'UI and navigation must be operable' },
          { key: 'understandable', name: '3. Understandable', desc: 'Information and UI operation must be understandable' },
          { key: 'robust', name: '4. Robust', desc: 'Content must be robust enough for various technologies' }
        ];

        principles.forEach(principle => {
          const count = homepage.wcag_principles[principle.key] || 0;
          html += `
            <div class="principle-card">
              <div class="principle-header">
                <div>
                  <div class="principle-name">${principle.name}</div>
                  <div style="color: #7f8c8d; font-size: 0.9em;">${principle.desc}</div>
                </div>
                <div class="principle-count">${count} issue${count !== 1 ? 's' : ''}</div>
              </div>
            </div>
          `;
        });
      }

      // Issues by Code (Top Issues)
      if (homepage.issues_by_code && homepage.issues_by_code.length > 0) {
        html += '<h2>üìà Most Common Issues</h2>';
        html += '<table>';
        html += '<thead><tr><th>WCAG Code</th><th>Occurrences</th></tr></thead>';
        html += '<tbody>';

        homepage.issues_by_code.slice(0, 10).forEach(issue => {
          html += `
            <tr>
              <td><code>${issue.code}</code></td>
              <td><span class="badge danger">${issue.count}</span></td>
            </tr>
          `;
        });

        html += '</tbody></table>';
      }

      // Detailed Errors
      if (homepage.errors && homepage.errors.length > 0) {
        html += `<h2>üö® Accessibility Errors (${homepage.errors_count})</h2>`;
        html += '<p>Critical issues that must be fixed for WCAG 2.1 AA compliance:</p>';

        homepage.errors.slice(0, 20).forEach((error, index) => {
          html += `
            <div class="issue-card error">
              <div class="issue-header">
                <span class="issue-code">${error.code}</span>
                <span class="issue-type error">Error</span>
              </div>
              <div class="issue-message">${error.message}</div>
              ${error.context ? `<div class="issue-context">${escapeHtml(error.context)}</div>` : ''}
              ${error.selector ? `<div class="issue-selector">Selector: ${error.selector}</div>` : ''}
            </div>
          `;
        });

        if (homepage.errors.length > 20) {
          html += `<p style="text-align: center; color: #7f8c8d; margin: 20px 0;">Showing first 20 of ${homepage.errors.length} errors. Check full JSON report for complete list.</p>`;
        }
      } else {
        html += '<h2>‚úÖ No Errors Found</h2>';
        html += '<div class="no-issues">Great! No accessibility errors detected on the homepage.</div>';
      }

      // Detailed Warnings
      if (homepage.warnings && homepage.warnings.length > 0) {
        html += `<h2>‚ö†Ô∏è Accessibility Warnings (${homepage.warnings_count})</h2>`;
        html += '<p>Issues that should be reviewed for better accessibility:</p>';

        homepage.warnings.slice(0, 10).forEach((warning, index) => {
          html += `
            <div class="issue-card warning">
              <div class="issue-header">
                <span class="issue-code">${warning.code}</span>
                <span class="issue-type warning">Warning</span>
              </div>
              <div class="issue-message">${warning.message}</div>
              ${warning.context ? `<div class="issue-context">${escapeHtml(warning.context)}</div>` : ''}
              ${warning.selector ? `<div class="issue-selector">Selector: ${warning.selector}</div>` : ''}
            </div>
          `;
        });

        if (homepage.warnings.length > 10) {
          html += `<p style="text-align: center; color: #7f8c8d; margin: 20px 0;">Showing first 10 of ${homepage.warnings.length} warnings. Check full JSON report for complete list.</p>`;
        }
      }

      // Recommendations
      html += '<h2>üí° Recommendations</h2>';
      html += '<div class="info-box">';

      if (homepage.errors_count === 0) {
        html += '<p><strong>Excellent!</strong> Your homepage has no accessibility errors. Continue monitoring accessibility as you add new content.</p>';
      } else if (homepage.errors_count <= 5) {
        html += '<p><strong>Good progress!</strong> You have only a few errors to fix. Focus on resolving these to achieve full WCAG 2.1 AA compliance.</p>';
      } else if (homepage.errors_count <= 15) {
        html += '<p><strong>Action needed:</strong> Multiple accessibility issues detected. Prioritize fixing errors that affect critical user journeys.</p>';
      } else {
        html += '<p><strong>Urgent attention required:</strong> Significant accessibility issues found. Consider consulting with accessibility experts and conducting user testing.</p>';
      }

      html += '<ul style="margin-top: 10px;">';
      html += '<li>Run Pa11y tests regularly during development</li>';
      html += '<li>Combine automated testing with manual accessibility reviews</li>';
      html += '<li>Test with actual assistive technologies (screen readers, keyboard navigation)</li>';
      html += '<li>Consider using Pa11y CI for automated testing in your deployment pipeline</li>';
      html += '<li>Review WCAG 2.1 guidelines: <a href="https://www.w3.org/WAI/WCAG21/quickref/" target="_blank">https://www.w3.org/WAI/WCAG21/quickref/</a></li>';
      html += '</ul>';
      html += '</div>';

      container.innerHTML = html;
      loadingElement.style.display = 'none';
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Render on page load
    renderAccessibility();
  </script>
</body>
</html>
